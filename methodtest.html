<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Method test</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico">
    </head>
   <body>
        <form id="httpForm">
            <fieldset>
                <label for="id">ID:</label>
                <input type="text" name="id" id="id"/>
            </fieldset>
            <fieldset>
                <label for="article_name">Article Name:</label>
                <input type="text" name="article_name" id="article_name"/>
            </fieldset>
            <fieldset>    
                <label for="article_body">Message:</label>
                <textarea id="article_body" form="httpForm" name="article_body"></textarea>
            </fieldset>

            <button id="postBtn" type="submit">Post</button>
            <button id="getBtn" type="submit">Get</button>
            <button id="putBtn" type="submit">Put</button>
            <button id="deleteBtn" type="submit">Delete</button>
        </form>
        <h2>Output:</h2>
        <output id="reponse"></output>
   </body>
   <script>
        let postBtn = document.getElementById("postBtn");
        let getBtn = document.getElementById("getBtn");
        let putBtn = document.getElementById("putBtn");
        let deleteBtn = document.getElementById("deleteBtn");

        postBtn.requestType = "post"
        postBtn.addEventListener("click", sendRequest);

        getBtn.requestType = "get"
        getBtn.addEventListener("click", sendRequest);

        putBtn.requestType = "put"
        putBtn.addEventListener("click", sendRequest);

        deleteBtn.requestType = "delete"
        deleteBtn.addEventListener("click", sendRequest);
        

        async function sendRequest(e) {
            e.preventDefault();
            let requestType = e.target.requestType;

            let response = null;
            let data = new FormData(document.forms.httpForm);;
            
            if(requestType == "put" || requestType == "post" ){ //puts data in body
                data.append('date', Date());         
                response = await fetch(`https://httpbin.org/${requestType}`, {
                    method : `${requestType.toUpperCase()}`,
                    body : data,
                });
            } else { //puts data in URL
                data = new URLSearchParams(data);               
                response = await fetch(`https://httpbin.org/${requestType}?${data}`, {
                    method : `${requestType.toUpperCase()}`,
                });
            }
            let status = response.status;
            response = await response.json(); 
            outputResponse(response, status);
        }
        //outputs response
        function outputResponse(response, status) {
        
            let text = "<table border=1>"

            //show status code
            text += `<tr><td><b>Status Code: </b></td><td>${status}</td>`;

            for (let x in response) {
                contents = response[x];
                if(typeof contents === "object") {
                    contents = `<pre>${JSON.stringify(contents)}<pre>`;
                    contents = contents.replaceAll(',', ',\n');
                }
                text += `<tr><td><b>${x}</b></td><td>${contents}</td>`;
            }
            text += "</table>"
            document.getElementById("reponse").innerHTML = text;

        }

   </script>
</html>